
{% extends "item.html" %}
{% load i18n %}
{% load markdown_extra %}
{% load data_display %}

{% block javascript %}
  {{ block.super }}
  <script type="text/javascript">

      {% if item.file or item.url %}

              
      {% endif %}
  </script>
{% endblock %}


{% block stylesheets %}
  {{ block.super }}
{% endblock %}


{% block title_name %}
    {% trans "Item" %}
    {% if item %}
     : {{  item.title}}
    {% endif %}
{% endblock %}

{% block content %}

{% block title_buttons %}
{% if user.is_authenticated %}
 <a href="{% url "item-add" id_institution=item.collection.mission.fonds.institution.id id_fond=item.collection.mission.fonds.id id_mission=item.collection.mission.id id_collection=item.collection.id %}" class="btn_add btn btn-default">
     <span class="glyphicon glyphicon-plus"></span>
     {% trans "Créer un item" %}
 </a>
  <a href="{% url "item-edit" id=id %}"  class="btn_add btn btn-default">
    <span class="glyphicon glyphicon-edit"></span> {% trans "Modifier" %}
  </a>
  {% endif %}
{% endblock %}

{% block title %}
  {{ block.super }}
{% endblock %}

{% if not error|length %}
  {% if item %}
  <figure>
    <figcaption>{{item.file}}</figcaption>
    <audio
        controls
        src="/api/item/{{item.id}}/download">
            Votre navigateur Internet ne prend pas en charge cet élément audio
    </audio>.
 </figure>

  <!-- Tabs -->
  <ul class="nav nav-tabs" role="tablist">
     <li class="nav-item active">
       <a href="#tab_general" role="tab" data-toggle="tab">{% trans "Général" %}</a>
     </li>
     <li class="nav-item">
       <a href="#tab_desc" role="tab" data-toggle="tab">{% trans "Description" %}</a>
     </li>
     <li class="nav-item">
       <a href="#tab_text" role="tab" data-toggle="tab">{% trans "Texte" %}</a>
     </li>
     <li class="nav-item">
       <a href="#tab_vox" role="tab" data-toggle="tab">{% trans "Voix/Instruments" %}</a>
     </li>
  </ul>

  <div class="tab-content">
    <!-- Tab General -->
    <section class="tab-pane fade active in" id="tab_general">
      <h2>Général</h2>

      <div class="champs_general">
        <dl class="container_data">
          <dt class="libelle"> {{form.collection.label|safe}}</dt>
          <dd class="donnee">
            <a href="{% url "collection-detail" id=item.collection.id %}">
              {{item.collection.title|safe}}
            </a>
          </dd>
        </dl>
        {{item.locations}}
        {% field_data form.title.label|safe item.title|safe %}
        {% field_data form.alt_title.label|safe item.alt_title|safe empty=False %}
        {% field_data form.trans_title.label|safe item.trans_title|safe empty=False %}
      </div>

      <div class="container_line">
        {% field_data form.description.label|safe item.description|markdown|safe %}
      </div>

      <div class="block-grey">
        <h2>{% trans "Personnes" %}</h2>
        {% related_list libelle='Enquêteurs' items=item.collectors url_detail="personne-detail" field="first_name" field2="last_name"%}
        {% related_list libelle='Informateurs' items=item.informers url_detail="personne-detail" field="first_name" field2="last_name"%}
      </div>

      <div class="block-grey">
        <h2>{% trans "Données d'archivage" %}</h2>
        {% field_data form.code.label|safe item.code|upper|safe %}
        {% field_data form.code_partner.label|safe item.code_partner|safe empty=False %}
      </div>
      
      <div class="block-grey">
        <h2>{% trans "Données techniques" %}</h2>
        {% field_data form.approx_duration.label|safe item.approx_duration|safe empty=False %}
      </div>

      <div class="block-grey">
        <h2>{% trans "Indications géographiques et culturelles" %}</h2>
        {% related_list libelle='Lieux' items=locations url_detail="location_gis-detail" field="code" %}
        {% field_data form_collection.location_details.label|safe item.collection.location_details|markdown|safe empty=False %}
        {% related_list libelle='Langues' items=item.languages  url_detail="language-detail" field="name" empty=False %}
        {% field_data form_collection.recording_context.label|safe item.collection.recording_context|safe %}
      </div>

      {% display_documents %}

    </section>

    <!-- Tab Description ------------------------------------- -->
    <section class="tab-pane" id="tab_desc">
      <h2>Description</h2>
      {% related_list libelle='Auteurs' items=item.authors url_detail="personne-detail" field="first_name" field2="last_name" empty=False %}
      {% related_list libelle='Compositeurs' items=item.compositors url_detail="personne-detail" field="first_name" field2="last_name" empty=False %}
      {% field_data form.timbre.label|safe item.timbre|safe empty=False %}
      {% field_data form.timbre_ref.label|safe item.timbre_ref|safe empty=False %}

      {% field_data form.domain.label|safe item.domain|domains|safe %}

      {% if item.melody and item.melody != "None" %}
      <div class="block-grey row">
        <div class="col-md-6">
          <label for="id_melody" class="melody">Mélodie (transcription alphabétique)</label>
          <textarea name="melody" id="id_melody" cols="80" rows="15" readonly>
              {{item.melody|safe}}
          </textarea>
          <div id="midi"></div>
          <div id="midi-download"></div>
          <div id="warnings"></div>
        </div>
        <div class="col-md-6">
          <div id="paper0" class="paper"></div>

          <div id="selection"></div>
        </div>
        <script src="{{ STATIC_URL }}francoralite_front/js/melody_abc.js" type="text/javascript"></script>
      </div>

      {% endif %}

      <div class="container_data">
        <h3 class="libelle">{{form.domains.label|safe}}</h3>
        {% related_list libelle='Genre(s) de la chanson' items=item.domain_songs url_detail="domain_song-detail" field="name" empty=False %}
        {% related_list libelle="Genre(s) de l'expression vocale" items=item.domain_vocals url_detail="domain_vocal-detail" field="name" empty=False %}
        {% related_list libelle="Genre(s) de l'expression instrumentale" items=item.domain_musics url_detail="domain_music-detail" field="name" empty=False %}
        {% related_list libelle='Genre(s) du conte' items=item.domain_tales url_detail="domain_tale-detail" field="name" empty=False %}
        {% related_list libelle='Fonction(s)' items=item.usefulnesses url_detail="usefulness-detail" field="name" empty=False %}
        {% related_list libelle='Danse(s)' items=item.dances url_detail="dance-detail" field="name" empty=False %}
      </div>

      {% if item.deposit_digest or item.thematics or item_deposit_names or item.deposit_places or item.deposit_periods %}
      <aside class="block-grey">
        <h2>{% trans "Témoignage" %}</h2>
        {% field_data form.deposit_digest.label|safe item.deposit_digest|markdown|safe empty=False %}
        {% related_list libelle='Thématique(s)' items=item.thematics url_detail="thematic-detail" field="name"  empty=False%}
        {% field_data form.deposit_names.label|safe item.deposit_names|safe empty=False %}
        {% field_data form.deposit_places.label|safe item.deposit_places|safe empty=False %}
        {% field_data form.deposit_periods.label|safe item.deposit_periods|safe empty=False %}
      </aside>
      {% endif %}
    </section>

    <!-- Tab Text ---------------------------------------------->
    <section class="tab-pane" id="tab_text">
      <h2>Texte</h2>

      {% field_data form.text.label|safe item.text|markdown|safe empty=False %}
      {% field_data form.incipit.label|safe item.incipit|markdown|safe empty=False %}
      {% field_data form.refrain.label|safe item.refrain|markdown|safe empty=False %}
      {% field_data form.jingle.label|safe item.jingle|markdown|safe empty=False %}
      {% field_data form.coupe.label|safe item.coupe.name|safe empty=False %}

      <aside class="block-grey">
        <h3>{% trans "Références" %}</h3>
        {% related_list libelle='Coirault' items=item.coiraults url_detail="coirault-detail" field="number" field2="name"%}
      </aside>
    </section>


    <!-- Tab Vox/Instruments ---------------------------------- -->
    <section class="tab-pane" id="tab_vox">
      <h2>{% trans "Voix/Instruments" %}</h2>
      {% related_list libelle='Organisation musicale' items=item.musical_organizations url_detail="musical_organization-detail" field="name"  empty=False %}
      {% related_list libelle='Formation musicale' items=item.musical_groups url_detail="musical_group-detail" field="name" empty=False %}

      {% if performances %}
      <div class="block-grey">
        <h2>{% trans "Voix/Instruments" %}</h2>
        <span class="container_data">
          {% for performance in performances %}
          <div class="container_line">
              {% if performance.performance.number %}
              <dl class="container_data number">
                <dt class="libelle">{% trans 'Nombre' %}</dt>
                <dd class="donnee">{{performance.performance.number}}</dd>
              </dl>
              {% endif %}

              {% if performance.performance.instrument %}
              <dl class="container_data instrument">
                <dt class="libelle">{% trans 'Instrument' %}</dt>
                <dd class="donnee">{{performance.performance.instrument.name}}</dd>
              </dl>
              <dl class="container_data thb">
                <dt class="libelle">{% trans 'Typologie Horn-Bostel' %}</dt>
                <dd class="donnee">{{performance.performance.instrument.typology.number}} :
                {{performance.performance.instrument.typology.name}}</dd>
              </dl>
              {% endif %}

              {% if performance.performance.emit %}
              <dl class="container_data">
                <dt class="libelle">{% trans "Nature de l'émission vocale" %}</dt>
                <dd class="donnee">{{performance.performance.emit.name}}</dd>
              </dl>
              {% endif %}

              {% if performance.performance.musicians %}
              <dl class="container_data">
                <dt class="libelle">{% trans 'Musiciens' %}</dt>
                <dd class="donnee">
                  {% for musician in performance.performance.musicians %}
                    {% if not forloop.first %} | {% endif %}
                    {{musician.first_name}}  {{musician.last_name}}
                  {% endfor %}
                </dd>
              </dl>
              {% endif %}

          </div>
          {% endfor %}
        </span>
      </div>
      {% endif %}

    </section>

  </div>

  {% else %}
    <p>{% trans "Cet item n'existe pas." %}</p>
    {% endif %}
  {% else %}
    {% display_error error %}
  {% endif %}
  {% endblock %}
